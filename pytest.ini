[pytest]
# Test discovery patterns
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Coverage configuration
addopts = 
    -v
    --strict-markers
    --tb=short
    --cov=modules
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=80

# Markers for test categorization
markers =
    # Test types
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, test interactions)
    property: Property-based tests (fuzz testing with hypothesis)
    benchmark: Performance benchmarks
    slow: Slow tests (skip with -m 'not slow')
    
    # Component markers
    tts: Text-to-Speech related tests
    audio: Audio processing tests
    parser: File parser tests
    pipeline: Pipeline orchestration tests
    ui: User interface tests
    
    # Feature markers
    mlx: Tests requiring MLX framework
    ffmpeg: Tests requiring FFmpeg
    gpu: Tests requiring GPU/Neural Engine

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning:pytest.*:
    ignore::UserWarning
    error::RuntimeWarning

# Async configuration
asyncio_mode = auto

# Hypothesis configuration for property-based testing
hypothesis_profile = default

[pytest.hypothesis.default]
# Default settings for property-based tests
deadline = 5000  # 5 second timeout per test
max_examples = 100
print_blob = true
stateful_step_count = 50

[pytest.hypothesis.ci]
# CI settings - more thorough but slower
deadline = 10000
max_examples = 1000
print_blob = true

[pytest.hypothesis.quick]
# Quick settings for development
deadline = 1000
max_examples = 10
print_blob = false

# Coverage exclusions (don't count these toward coverage)
[coverage:run]
source = modules
omit = 
    */tests/*
    */test_*
    */venv/*
    */__pycache__/*
    modules/ui/*  # UI code tested manually
    
[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if __name__ == .__main__.:
    raise NotImplementedError
    pass
    if TYPE_CHECKING:
    except ImportError:
    # Debug code
